# Chapter 10: 개인화된 뉴스 피드

> **9회차** | 10장 | Personalized News Feed

## 📖 핵심 내용 정리

### 1. 요구사항 명확화

해당 단계는 요구사항에 대해 면접관과 합의하는 단계다.
비즈니스 목표, 시스템이 제공해야 하는 피처, 제약, 시스템 규모 및 성능을 정한다.

| 항목 | 내용 |
|:---|:---|
| **비즈니스 목표** | 사용자들이 플랫폼에 계속 머무르게 하는 것 |
| **시스템 피처** | 클릭, 좋아요, 공유, 숨기기, 사용자 차단 |
| **시스템 규모** | DAU 20억명, 하루 두 번씩 피드 확인 |
| **성능 요구사항** | 200밀리초 이내 새로고침 표시 |

#### 궁금한 점
1. 보이지 않는 게시물과 댓글이 보이지 않는 게시물은 어떤 의미인지?
2. 200밀리초 이상 걸리지 않아야 한다는 사실이 나중에 어떤 의사결정에 영향을 주는지?
   - → 책에선 따로 다루지 않음

---

### 2. 머신러닝 문제 구조화

- 머신러닝 목표 정의 (지표 정의)
- 입력 및 출력
- 머신러닝 유형 (지도, 비지도, 강화학습 등)

#### 머신러닝 목표 정의

사용자들이 플랫폼에 계속 머무르게 하는 것을 어떻게 전환할 것인가?

| 반응 유형 | 설명 | 장점 | 단점 |
|:---|:---|:---|:---|
| **암시적 반응 수** | 사용자의 체류 시간이나 클릭 수 | 명시적 반응 수보다 데이터가 더 많음 | 사용자의 실제 의견 반영 못함 (클릭은 했는데 사실 쓸모 없는 경우) |
| **명시적 반응 수** | 좋아요 또는 공유 | 강력한 신호 | 매우 적은 사용자들이 명시적 방법으로 의견 표현 |

**→ 암시적 반응 + 명시적 반응 가중 평균**

비즈니스에 중요한 요소에 따라 시스템 가중치를 달리하면서 적용할 수 있고, 한 쪽에 치우치지 않음.

#### 입력 및 출력

- **입력**: 사용자
- **출력**: 댓글 관련 신호를 피처로 포함하는 게시물

#### 머신러닝 유형

- **Pointwise LTR**: 좋아요, 클릭 등에 대해서 확률 예측 후 가중 합산

#### 궁금한 점

1. **비즈니스 목표가 체류 시간인데 왜 머신러닝 목표를 체류 시간을 단독으로 잡지 않는가?**
   - 체류 시간은 UI, 컨텐츠 길이, 사용자 상황 등 모델의 품질과 무관한 요인이 너무 많아서 이걸 모델의 목표로 잡기엔 왜곡이 일어날 가능성이 있다.

2. **클릭률 단독 목표는 위험한가?**
   - 클릭 = 만족이 아니기 때문에 단독 목표로 한다면 모델은 과장된 제목 같은 것들을 랭킹 상위로 올릴 수 있다. 클릭은 단기적으로 좋아보이지만 장기적으로는 좋지 않다.
   - → **뭐가 되었든 단독 목표는 편향될 수 있으므로 복합 목표로 구성하는 것이 좋다.**

---

### 3. 데이터 처리

데이터 엔지니어링과 피처 엔지니어링을 어떻게 할 것인가?

#### 데이터 엔지니어링

**원시 데이터**
- 사용자 table
- 게시물 table
- 사용자-게시물 상호작용 table (좋아요, 공유, 댓글 등)
- 친구 관계

#### 피처 엔지니어링

**게시물 피처**

| 피처 | 설명 | 변환 방법 |
|:---|:---|:---|
| 텍스트 컨텐츠 | 게시글의 주제 파악 | 임베딩 벡터 변환 |
| 이미지 또는 동영상 | 중요한 신호 감지 (총 이미지) | 임베딩 벡터 변환 |
| 반응 | 얼마나 인기 있는 게시물인지 | 숫자로 변환 |
| 해시태그 | 게시물이 관련된 주제 | word2vec 후 집계 |
| 게시물 게시 기간 | 새로운 컨텐츠인지 | 버킷화 후 원-핫 인코딩 |

**사용자 피처**

| 피처 | 설명 | 변환 방법 |
|:---|:---|:---|
| 개인정보 | - | - |
| 상황별 정보 | - | - |
| 사용자-게시물 상호작용 이력 | 자신을 언급하는 게시물에 관심 | 게시물 피처 집계 |
| 게시물에 언급됨 | 자신을 언급했는지 | 0 또는 1 |

**사용자-작성자 친밀도 피처**

| 피처 | 설명 | 변환 방법 |
|:---|:---|:---|
| 작성자 이전 게시글 좋아요/클릭/댓글/공유 비율 | - | 각각의 비율 사용 |
| 친구 관계 기간 | 친구들과 더 많이 소통함 | 플랫폼에서 친구로 지낸 일 수 |
| 친한 친구 및 가족 | 친밀도 높으면 상호작용 많이 함 | 0 또는 1 |

---

### 4. 모델 관련

모델 선택 및 학습 방법 선택

#### 모델 선택

**MLP 모델**
- 비정형 데이터에 대해 잘 작동
- 범주형 특징 잘 표현

**N개의 DNN vs 멀티태스크 DNN**
- 훈련 비용 + 빈도가 낮은 경우 데이터 충분치 않은 것의 단점 없애는 **멀티태스크 DNN 활용**

**추가 확률 보정**
- 대부분의 사용자가 수동적으로 이용하므로 클릭 확률 빼고 명시적 값들인 공유, 좋아요 등은 대부분 매우 낮은 확률값 나옴
- 이를 보정하기 위해 암시적인 값인 두 개의 확률 추가:
  - 체류 시간이 일정 값을 넘을 확률
  - 건너뛸 확률 (t초 미만)

#### 모델 훈련

- 좋아요, 체류시간 등에서 각각의 데이터마다 포지티브, 네거티브 데이터 생성
- 이후 각각의 출력 계층 학습

---

### 5. 평가

오프라인 평가와 온라인 평가를 어떻게 할 것인가?

#### 오프라인 지표

- 개별 유형은 **Precision**과 **Recall**

#### 온라인 지표

| 지표 유형 | 설명 |
|:---|:---|
| **클릭률** | - |
| **반응률** | 좋아요 비율, 숨기기 비율, 차단 비율 등 (명시적이므로 강력한 신호) |
| **수동적인 사용자를 위한 지표** | 총 사용 시간 |
| **사용자 설문 조사** | - |

---

### 6. 서비스 운영 및 배포

클라우드 vs 온디바이스, 모델 압축, 운영 환경 테스트, 예측 파이프라인

#### 데이터 준비 파이프라인

- (상세 내용 생략)

#### 예측 파이프라인

```
검색 서비스 → 순위 서비스 → 리랭킹
```

- **순위 서비스**: LTR 적용
- **리랭킹**: 사용자 필터 통합 및 추가 로직해서 더 높은 순위 결정
